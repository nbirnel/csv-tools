<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>/cygdrive/u/SHARED/GENERAL/_SoftwareRepository/noahtools/csv-tools/chead.html</title>
<meta name="Generator" content="Vim/7.3">
<meta name="plugin-version" content="vim7.3_v6">
<meta name="syntax" content="perl">
<meta name="settings" content="use_css">
<style type="text/css">
<!--
pre { font-family: monospace; color: #000000; background-color: #ffffff; }
body { font-family: monospace; color: #000000; background-color: #ffffff; }
.Todo { color: #000000; background-color: #ffff00; }
.Comment { color: #ff6060; }
.Type { color: #8080ff; }
.Special { color: #ff40ff; }
.Identifier { color: #8080ff; }
.Constant { color: #ff40ff; }
.Statement { color: #c00000; }
.PreProc { color: #ff40ff; }
-->
</style>
</head>
<body>
<pre>
<span class="PreProc">#!/usr/bin/perl</span>
<span class="Statement">use strict</span>;
<span class="Statement">use vars</span> <span class="Constant">qw(</span><span class="Constant">$opt_h $opt_i $opt_u</span><span class="Constant">)</span>;
<span class="Statement">use </span>Getopt::Std;
<span class="Statement">use </span>English;
<span class="Statement">use </span>Text::ParseWords;

<span class="Identifier">$RS</span>  = <span class="Constant">&quot;</span><span class="Special">\r\n</span><span class="Constant">&quot;</span>;
<span class="Identifier">$ORS</span> = <span class="Constant">&quot;</span><span class="Special">\r\n</span><span class="Constant">&quot;</span>;

<span class="Statement">my</span> (<span class="Identifier">@requests</span>);

<span class="Statement">my</span> <span class="Identifier">$delim</span> = <span class="Constant">'</span><span class="Constant">,</span><span class="Constant">'</span>;
<span class="Statement">my</span> <span class="Identifier">$keepqu</span> = <span class="Constant">0</span>;
<span class="Statement">my</span> <span class="Identifier">$inverse</span> = <span class="Constant">0</span>;
<span class="Statement">my</span> <span class="Identifier">@input</span>;

getopts(<span class="Constant">'</span><span class="Constant">hiu</span><span class="Constant">'</span>);
<span class="Statement">if</span> (<span class="Identifier">$opt_h</span>) { <span class="Identifier">&amp;help</span>(<span class="Constant">0</span>); }
<span class="Statement">if</span> (<span class="Identifier">$opt_i</span>) { <span class="Identifier">$inverse</span>=<span class="Constant">1</span>; }
<span class="Statement">if</span> (<span class="Identifier">$opt_u</span>) {
    <span class="Identifier">$RS</span>  = <span class="Constant">&quot;</span><span class="Special">\n</span><span class="Constant">&quot;</span>;
    <span class="Identifier">$ORS</span> = <span class="Constant">&quot;</span><span class="Special">\n</span><span class="Constant">&quot;</span>;
}

<span class="Statement">while</span> (<span class="Statement">scalar</span>(<span class="Identifier">@ARGV</span>) &gt; <span class="Constant">1</span>) {
    <span class="Statement">push</span> <span class="Identifier">@requests</span>, (<span class="Statement">shift</span> <span class="Identifier">@ARGV</span>);
}

<span class="Statement">LINE:</span> <span class="Statement">while</span> (&lt;&gt;) {
    <span class="Statement">chomp</span>;
    <span class="Identifier">@input</span> = quotewords(<span class="Identifier">$delim</span>, <span class="Identifier">$keepqu</span>, <span class="Identifier">$_</span>);
    <span class="Statement">if</span>    (<span class="Identifier">$inverse</span>)  { <span class="Identifier">&amp;printinverse</span>(); }
    <span class="Statement">elsif</span> (<span class="Identifier">@requests</span>) { <span class="Identifier">&amp;printrequests</span>(); }
    <span class="Statement">else</span> {
        <span class="Statement">my</span> <span class="Identifier">$i</span> = <span class="Constant">0</span>;
        <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$field</span> (<span class="Identifier">@input</span>) {
            <span class="Statement">printf</span>(<span class="Constant">&quot;</span><span class="Constant">%3d: %s</span><span class="Identifier">$OUTPUT_RECORD_SEPARATOR</span><span class="Constant">&quot;</span>, ++<span class="Identifier">$i</span>, <span class="Identifier">$field</span>);
        }
    }
    <span class="Statement">last</span> LINE;
}

<span class="Statement">sub </span><span class="Identifier">printinverse</span><span class="Type">() </span>{
    <span class="Statement">my</span> <span class="Identifier">$notfirst</span>;
    <span class="Statement">my</span> <span class="Identifier">$i</span> = <span class="Constant">0</span>;
<span class="Statement">    IFIELD:</span> <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$field</span> (<span class="Identifier">@input</span>) {
        <span class="Identifier">$i</span>++;
        <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$request</span> (<span class="Identifier">@requests</span>) {
            <span class="Statement">if</span> (<span class="Identifier">$request</span> <span class="Statement">eq</span> <span class="Identifier">$field</span>) { <span class="Statement">next</span> IFIELD; }
        }
        <span class="Statement">if</span> (<span class="Identifier">$notfirst</span>) { <span class="Statement">printf</span> <span class="Constant">&quot;</span><span class="Constant">,</span><span class="Constant">&quot;</span> }
        <span class="Statement">printf</span>(<span class="Constant">&quot;</span><span class="Constant">%d</span><span class="Constant">&quot;</span>, <span class="Identifier">$i</span>);
        <span class="Identifier">$notfirst</span> = <span class="Constant">1</span>;
    }
}

<span class="Statement">sub </span><span class="Identifier">printrequests</span><span class="Type">() </span>{
    <span class="Comment">#</span><span class="Todo">FIXME</span><span class="Comment"> This is essentially the last function inside-out. refactor?</span>
    <span class="Statement">my</span> <span class="Identifier">$notfirst</span>;
    <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$request</span> (<span class="Identifier">@requests</span>) {
        <span class="Statement">if</span> (<span class="Identifier">$notfirst</span>) { <span class="Statement">printf</span> <span class="Constant">&quot;</span><span class="Constant">,</span><span class="Constant">&quot;</span> }
        <span class="Statement">my</span> <span class="Identifier">$i</span> = <span class="Constant">0</span>;
<span class="Statement">        FIELD:</span> <span class="Statement">foreach</span> <span class="Statement">my</span> <span class="Identifier">$field</span> (<span class="Identifier">@input</span>) {
            <span class="Identifier">$i</span>++;
            <span class="Statement">if</span> (<span class="Identifier">$request</span> <span class="Statement">eq</span> <span class="Identifier">$field</span>) {
                <span class="Statement">printf</span>(<span class="Constant">&quot;</span><span class="Constant">%d</span><span class="Constant">&quot;</span>, <span class="Identifier">$i</span>);
                <span class="Statement">last</span> FIELD;
            }
        }
        <span class="Identifier">$notfirst</span> = <span class="Constant">1</span>;
    }
}

<span class="Statement">sub </span><span class="Identifier">help </span>{
    <span class="Statement">my</span> <span class="Identifier">$status</span> = <span class="Statement">shift</span>;
    <span class="Statement">while</span> (<span class="Identifier">&lt;DATA&gt;</span>) { <span class="Statement">print</span>; }
    <span class="Statement">exit</span> <span class="Identifier">$status</span>;
}

<span class="Comment">__END__</span>

<span class="Comment">chead - display field headers for a csv file</span>

<span class="Comment">USAGE</span>
<span class="Comment">chead [-u] FILE</span>
<span class="Comment">chead [-u] {FIELD} {FIELD}... {FILE}</span>
<span class="Comment">chead -i [-u] {FIELD} {FIELD}... {FILE}</span>
<span class="Comment">chead -h</span>

<span class="Comment">In the first form, chead will display all field headers, numbered one</span>
<span class="Comment">per line, for FILE.</span>

<span class="Comment">In the second form, chead will output the matching field headers as</span>
<span class="Comment">a comma-separated list of numbers, suitable for use as a flag for ccut,</span>
<span class="Comment">cdel, etc.</span>

<span class="Comment">The third form is the inverse of the second form - it outputs the </span>
<span class="Comment">field headers that do not match.</span>

<span class="Comment">OPTIONS </span>
<span class="Comment">-h  Display help and exit. </span>
<span class="Comment">-i  Invert the matching of field headers.</span>
<span class="Comment">-u  Use unix line endings for input and output</span>

<span class="Comment">EXAMPLES</span>

<span class="Comment">SEE ALSO</span>
<span class="Comment">ccut</span>
<span class="Comment">chead</span>
<span class="Comment">cjoin</span>
<span class="Comment">csort</span>
<span class="Comment">cval</span>

<span class="Comment">BUGS</span>
<span class="Comment">Don't use this with Strawberry Perl. If you are on Windows,</span>
<span class="Comment">use Cygwin Perl. (Not tested with ActiveState Perl.)</span>

<span class="Comment">Fields are numbered from 1 on the command line, but internally</span>
<span class="Comment">are represented from 0.</span>

<span class="Comment">Assumes all csvs use /r/n as EOL.</span>

<span class="Comment">TODO</span>
<span class="Comment">Does the file exist? Did we receive garbage flags?</span>
</pre>
</body>
</html>
